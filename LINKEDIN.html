(async () => {
  const sleep = ms => new Promise(res => setTimeout(res, ms));

  const filters = {
    sortBy: "Latest",
    datePosted: "Past month",
    contentType: "Images",
    postedBy: "People you follow",
    fromMembers: ["Pranav Borge"],
    fromCompanies: ["IES's Management College and Research Centre (IESMCRC)"],
    mentioningMembers: ["Sundar Pichai"],
    mentioningCompanies: ["Google"],
    authorIndustry: ["Information Technology"],
    authorCompany: ["TechCorp"],
    authorKeywords: ["AI", "Machine Learning"],
    authorTitle: ["Data Analyst"]
  };

  const openFilters = document.querySelector('button[aria-label*="Show all filters"]');
  if (openFilters) {
    openFilters.click();
    console.log("🟢 Opened filters panel");
    await sleep(2000);
  }

  async function applyCheckbox(group, option) {
    if (!group || !option) {
      console.warn(`❌ Group or Option missing: "${group}", "${option}"`);
      return;
    }

    const section = [...document.querySelectorAll("fieldset")].find(f => f.innerText.includes(group));
    if (!section) {
      console.warn(`❌ Section "${group}" not found`);
      return;
    }

    const label = [...section.querySelectorAll("label")].find(l => l.innerText.includes(option));
    if (!label) {
      console.warn(`❌ Option "${option}" not found in "${group}"`);
      return;
    }

    label.click();
    console.log(`✅ Selected "${option}" under "${group}"`);
    await sleep(1000);
  }

  await applyCheckbox("Sort by", filters.sortBy);
  await applyCheckbox("Date posted", filters.datePosted);
  await applyCheckbox("Content type", filters.contentType);
  await applyCheckbox("Posted by", filters.postedBy);

  async function applySearchable(ariaLabel, values, triggerText) {
    if (!values || values.length === 0) return;

    const trigger = [...document.querySelectorAll("button")].find(btn => btn.innerText.trim() === triggerText);
    if (!trigger) {
      console.warn(`❌ Trigger "${triggerText}" not found`);
      return;
    }

    trigger.click();
    console.log(`🟢 Trigger clicked: "${triggerText}"`);
    await sleep(1500);

    for (const val of values) {
      const input = document.querySelector(`input[aria-label="${ariaLabel}"]`);
      if (!input) {
        console.warn(`❌ Input with label "${ariaLabel}" not found`);
        continue;
      }

      input.focus();
      input.value = val;
      input.dispatchEvent(new Event("input", { bubbles: true }));
      console.log(`🔎 Typing: ${val}`);
      await sleep(2000);

      const options = [...document.querySelectorAll('[role="listbox"] li')];
      const match = options.find(o => o.innerText.toLowerCase().includes(val.toLowerCase()));
      const target = match || options[0];

      if (target) {
        target.click();
        console.log(`✅ Selected: ${target.innerText}`);
      } else {
        console.warn(`⚠️ No match found for "${val}"`);
      }

      await sleep(2000);
    }
  }

  await applySearchable("Add a person's name", filters.fromMembers, "Add a person's name");
  await applySearchable("Add a company's name", filters.fromCompanies, "Add a company's name");
  await applySearchable("Add a person's name", filters.mentioningMembers, "Mentioning member");
  await applySearchable("Add a company's name", filters.mentioningCompanies, "Mentioning company");
  await applySearchable("Add an industry", filters.authorIndustry, "Author industry");
  await applySearchable("Add a company", filters.authorCompany, "Author company");
  await applySearchable("Add a keyword", filters.authorKeywords, "Author Keywords");
  await applySearchable("Add a title", filters.authorTitle, "Title");

  await sleep(2000);
  const showBtn = [...document.querySelectorAll("button")].find(b => /show results/i.test(b.innerText));
  if (showBtn) {
    showBtn.click();
    console.log("🚀 Show results clicked");
  } else {
    console.warn("❌ 'Show results' button not found");
  }
})();
