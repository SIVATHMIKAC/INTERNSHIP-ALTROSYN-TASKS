(async () => {
  const wait = ms => new Promise(res => setTimeout(res, ms));

  const FILTERS = {
    sortBy: "Latest",
    datePosted: "Past week",
    contentType: "Images",
    postedBy: "People you follow",
    people: ["Swetha Guggal", "Pranav Borge"],
    companies: [
      "CeduraTech",
      "IES's Management College and Research Centre (IESMCRC)"
    ]
  };

  const openAllFilters = async () => {
    const btn = document.querySelector('button[aria-label*="Show all filters"]');
    if (!btn) return console.warn("üî¥ 'All filters' button not found");
    btn.click();
    console.log("üîì Opened all filters");
    await wait(1500);
  };

  const applyCheckbox = async (groupName, labelText) => {
    const group = [...document.querySelectorAll("fieldset")]
      .find(fs => fs.innerText.includes(groupName));
    if (!group) return console.warn(`‚ùå Group not found: ${groupName}`);

    const label = [...group.querySelectorAll("label")]
      .find(lbl => lbl.innerText.includes(labelText));
    if (!label) return console.warn(`‚ùå Option not found: ${labelText}`);

    label.click();
    console.log(`‚òëÔ∏è Selected "${labelText}" under "${groupName}"`);
    await wait(1000);
  };

  const searchAndSelect = async (ariaLabel, terms, buttonText) => {
    if (buttonText) {
      const trigger = [...document.querySelectorAll("button")]
        .find(btn => btn.innerText.trim() === buttonText);
      if (trigger) {
        trigger.click();
        console.log(`üîò Clicked "${buttonText}"`);
        await wait(1000);
      }
    }

    for (const term of terms) {
      const input = document.querySelector(`input[aria-label="${ariaLabel}"]`);
      if (!input) {
        console.warn(`‚ö†Ô∏è Input not found for "${ariaLabel}"`);
        continue;
      }

      input.focus();
      input.value = '';
      input.dispatchEvent(new Event('input', { bubbles: true }));
      await wait(300);

      for (let i = 0; i < term.length; i++) {
        input.value = term.substring(0, i + 1);
        input.dispatchEvent(new Event('input', { bubbles: true }));
        await wait(80);
      }

      await wait(1000);

      const suggestion = document.querySelector(
        '[role="listbox"] li, [role="option"], .autocomplete-item, .basic-typeahead__option'
      );
      if (suggestion) {
        suggestion.scrollIntoView({ block: "center" });
        await wait(300);
        suggestion.click();
        console.log(`üéØ Selected suggestion: "${term}"`);
      } else {
        console.warn(`‚ö†Ô∏è No suggestion found for "${term}"`);
      }

      await wait(1000);
    }
  };

  const handleEntitySelection = async (entities, labelText, ariaLabel, buttonText) => {
    for (const entity of entities) {
      const existing = [...document.querySelectorAll("label.search-reusables__value-label")]
        .find(lbl => lbl.innerText.trim().toLowerCase().includes(entity.toLowerCase()));

      if (existing) {
        const id = existing.getAttribute("for");
        const checkbox = document.getElementById(id);
        if (checkbox && !checkbox.checked) {
          existing.click();
          console.log(`‚úÖ Selected: "${entity}"`);
          await wait(1000);
        }
      } else {
        console.log(`üîç Searching for: "${entity}"`);
        await searchAndSelect(ariaLabel, [entity], buttonText);
      }
    }
  };

  const showResults = () => {
    const showBtn = [...document.querySelectorAll("button")]
      .find(btn => /show results/i.test(btn.innerText));
    if (showBtn) {
      showBtn.click();
      console.log("üöÄ Showing results");
    } else {
      console.warn("‚ö†Ô∏è 'Show results' button not found");
    }
  };

  const confirmSelections = () => {
    const tags = [...document.querySelectorAll('span.t-14.t-black--light.t-normal[aria-hidden="true"]')]
      .map(el => el.textContent.trim());

    console.log("üìã Confirmed selections:");
    FILTERS.people.forEach(name => {
      if (tags.some(tag => tag.includes(name))) console.log(`üë§ Person: ${name}`);
    });
    FILTERS.companies.forEach(org => {
      if (tags.some(tag => tag.includes(org))) console.log(`üè¢ Company: ${org}`);
    });
  };

  // üß≠ Execution Flow
  await openAllFilters();
  await applyCheckbox("Sort by", FILTERS.sortBy);
  await applyCheckbox("Date posted", FILTERS.datePosted);
  await applyCheckbox("Content type", FILTERS.contentType);
  await applyCheckbox("Posted by", FILTERS.postedBy);
  await handleEntitySelection(FILTERS.people, "person", "Add a person's name", "Add a person's name");
  await handleEntitySelection(FILTERS.companies, "company", "Add a company's name", "Add a company's name");
  confirmSelections();
  showResults();
})();

